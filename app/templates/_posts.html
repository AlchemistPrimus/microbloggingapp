<ul class="posts">
{% for post in posts %}
    <li class="post">
        <div class="profile-thumbnail">
            <a href="{{ url_for('main.user', username=post.author.username) }}"><img class="img-circle profile-thumbnail" src="{{ post.author.gravatar(size=40) }}"></a>
        </div>
        <div class="post-date">
            {{ moment(post.timestamp).fromNow() }}
        </div>
        <div class="post-author">
            <a href="{{ url_for('main.user', username=post.author.username) }}"> {{ post.author.username }}</a>
        </div>
        <div class="post-body">
            {% if post.body_html %}
                <!--safe suffix telling jinja2 not to escape html elements. jinja 2 ignores all template variables by default as a security measure but mark down is generated by the server hence rendered directly as html-->
                {{ post.body_html | safe }}
            {% else %}
                {{ post.body }}
            {% endif %}

            <div class="post-footer">
                <a href="{{ url_for('main.post', id=post.id) }}"><span class="label label-default">Permanent link</span></a>

                <a href="{{ url_for('main.post', id=post.id) }}#comments">
                    <span class="label label-primary">{{ post.comments.count() }} Comments</span>
                </a>

                {% if current_user == post.author %}
                    <a href="{{ url_for('main.edit', id=post.id) }}"><span class="label label-primary">Edit</span></a>
                {% elif current_user.is_administrator() %}
                    <a href="{{ url_for('main.edit', id=post.id) }}"><span class="label label-danger">Edit [Admin]</span></a>
                {% endif %}
            </div>
        </div>
    </li>
    <hr>
{% endfor %}
</ul>